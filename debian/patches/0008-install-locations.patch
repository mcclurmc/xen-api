From: Jon Ludlam <jonathan.ludlam@eu.citrix.com>
Date: Fri, 7 Oct 2011 14:44:40 +0100
Subject: install-locations

---
 ocaml/idl/OMakefile               |    2 +-
 ocaml/idl/ocaml_backend/OMakefile |    4 ++--
 ocaml/xe-cli/rt/OMakefile         |    1 +
 scripts/examples/python/OMakefile |    2 +-
 4 files changed, 5 insertions(+), 4 deletions(-)

--- a/ocaml/idl/OMakefile
+++ b/ocaml/idl/OMakefile
@@ -103,7 +103,7 @@
 	sed 's/@VERSION@/$(PRODUCT_VERSION)/g' < $< > $@
 
 if $(defined-env DESTDIR)
-	INSTALL_PATH = $(DESTDIR)/$(shell ocamlfind printconf destdir)
+	INSTALL_PATH = $(DESTDIR)/$(shell ocamlc -where)
 	export
 else
 	INSTALL_PATH = $(shell ocamlfind printconf destdir)
--- a/ocaml/idl/ocaml_backend/OMakefile
+++ b/ocaml/idl/ocaml_backend/OMakefile
@@ -155,7 +155,7 @@
 	sed 's/@VERSION@/$(PRODUCT_VERSION)/g' < $< > $@
 
 if $(defined-env DESTDIR)
-	INSTALL_PATH = $(DESTDIR)/$(shell ocamlfind printconf destdir)
+	INSTALL_PATH = $(DESTDIR)/$(shell ocamlc -where)
 	export
 else
 	INSTALL_PATH = $(shell ocamlfind printconf destdir)
@@ -164,7 +164,7 @@
 DATAMODEL_PACK_DIR=/tmp/xapi-datamodel
 
 lib-install: META
-	mkdir -p $(INSTALL_PATH)
+	mkdir -p $(INSTALL_PATH)/stublibs
 	ocamlfind install -destdir $(INSTALL_PATH) -ldconf ignore xapi-client META $(addsuffixes .cmi, $(XAPI_CLIENT_OBJS)) $(if $(BYTE_ENABLED), xapi_client.cma) $(if $(NATIVE_ENABLED), xapi_client.cmxa xapi_client.a $(addsuffixes .cmx, $(XAPI_CLIENT_OBJS)))
 
 .PHONY: lib-uninstall
--- a/ocaml/xe-cli/rt/OMakefile
+++ b/ocaml/xe-cli/rt/OMakefile
@@ -30,5 +30,6 @@
 	mkdir -p /tmp/cli-rt-domu/root
 	cp gtmessages.ml gtcomms.ml gtlinuxops.ml gtserver_linux.ml /tmp/cli-rt-domu/root
 	(cd $(ROOT)/scripts; /bin/sh ./make-patch /tmp/cli-rt-domu /tmp/cli-rt-domu-shar.sh)
+	mkdir -p $(DESTDIR)$(OPTDIR)/debug
 	mv /tmp/cli-rt-domu-shar.sh $(DESTDIR)$(OPTDIR)/debug
 	$(IPROG) install-debian-pv.sh install-debian-pv-inside.sh $(DESTDIR)$(OPTDIR)/debug
